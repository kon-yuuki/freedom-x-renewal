!function(){class t{constructor(t={}){document.body.classList.contains("top")?(this.options={progressSelector:".p-top-loading__progress",coverSelector:".p-top-loading",minLoadingDuration:500,debug:!1,waitForElementOnRevisit:null,waitForContentOnRevisit:!1,iframeTimeout:1e4,videoSelector:".p-top-loading video",topPagePaths:["/","/index.html"],expirationDays:7,storageKey:"visitData",...t},this.progress=document.querySelector(this.options.progressSelector),this.cover=document.querySelector(this.options.coverSelector),this.loadingTasks=[],this.loadingComplete=!1,this.startTime=null,this.finishTimeout=null,this.progressAnimationFrame=null,this.video=document.querySelector(this.options.videoSelector),this.currentProgress=0,this.targetProgress=0,this.videoStartTime=null,this.log("Loading class initialized"),this.shouldSkipLoading()?this.handleExistingSession():this.handleNewSession()):document.body.classList.add("is-loaded")}shouldSkipLoading(){if(this.options.debug)return!1;const t=this.getVisitData();return t&&!this.isExpired(t.timestamp)||!this.isTopPage()}isTopPage(){return document.body.classList.contains("top")}getVisitData(){const t=localStorage.getItem(this.options.storageKey);return t?JSON.parse(t):null}setVisitData(){const t={visited:!0,timestamp:Date.now()};localStorage.setItem(this.options.storageKey,JSON.stringify(t))}isExpired(t){return Date.now()-t>24*this.options.expirationDays*60*60*1e3}handleExistingSession(){this.log("Handling existing user or non-top page"),this.removeCoverElement(),Promise.all(this.loadingTasks.map((t=>t()))).then((()=>{document.body.classList.add("is-loaded"),this.log('All tasks completed, body class "is-loaded" added')})).catch((t=>{this.log(`Error in loading tasks: ${t}`),document.body.classList.add("is-loaded")})),this.isTopPage()&&(this.setVisitData(),this.log("Visit data updated for existing session"))}removeCoverElement(){this.cover&&setTimeout((()=>{this.cover.remove()}),5e3)}checkElementAndFinish(t){const i=document.querySelectorAll(t);this.log(`Checking for elements: ${t}, found: ${i.length}`),i.length>0&&this.options.waitForContentOnRevisit?Promise.all(Array.from(i).map((t=>this.waitForElement(t)))).then((()=>this.finishLoading())):this.finishLoading()}handleNewSession(){if(!this.isTopPage())return this.log("Not top page, skipping loading animation"),this.removeCoverElement(),void this.finishLoading();this.log("Handling new or expired session on top page"),document.body.classList.add("is-loading"),this.log('Body class "is-loading" added'),this.video?this.waitForVideoStart():this.startTimer()}waitForVideoStart(){this.log("Waiting for video to start");const t=()=>{this.video.play().then((()=>{this.videoStartTime=Date.now(),this.log("Video started playing - Timer start"),this.startTimer()})).catch((t=>{this.log(`Video autoplay failed: ${t} - Starting timer without video`),this.videoStartTime=Date.now(),this.startTimer(),this.video&&(this.video.style.display="none")}))};this.video.readyState>=2?t():(this.video.addEventListener("canplay",t,{once:!0}),setTimeout((()=>{this.startTime||(this.log("Video load timeout - Starting timer without video"),this.videoStartTime=Date.now(),this.startTimer())}),3e3))}startTimer(){this.startTime=Date.now(),this.log(`Timer started at ${this.startTime}`),this.updateProgress(),this.executeLoadingTasks()}updateProgress(){const t=()=>{if(!this.startTime)return void(this.progressAnimationFrame=requestAnimationFrame(t));const i=Date.now()-this.startTime;Math.floor(i/1e3)>Math.floor((i-16)/1e3)&&this.log(`Timer: ${(i/1e3).toFixed(1)}s`);const e=this.video?Math.max(this.options.minLoadingDuration,i):this.options.minLoadingDuration,o=Math.min(i/e,1);this.targetProgress=this.loadingComplete?1:.98*o;const s=this.loadingComplete?.1:.05;if(this.currentProgress+=(this.targetProgress-this.currentProgress)*s,this.progress){const t=Math.min(Math.round(100*this.currentProgress),100);this.progress.style.scale=`${t}% 100%`}const a=this.videoStartTime?Date.now()-this.videoStartTime:0,n=!this.video||a>=this.options.minLoadingDuration;if(this.loadingComplete&&this.currentProgress>=.995&&n){this.progress&&(this.progress.style.scale="100% 100%"),cancelAnimationFrame(this.progressAnimationFrame);const t=Date.now()-this.startTime;this.log(`Final loading time: ${(t/1e3).toFixed(1)}s`),this.completeLoading()}else this.progressAnimationFrame=requestAnimationFrame(t)};this.progressAnimationFrame=requestAnimationFrame(t)}addLoadingTask(t){this.shouldSkipLoading()?t():("function"==typeof t?this.loadingTasks.push(t):t instanceof Promise?this.loadingTasks.push((()=>t)):console.warn("Invalid loading task. Must be a function or a Promise."),this.log(`Loading task added. Total tasks: ${this.loadingTasks.length}`))}executeLoadingTasks(){Promise.all(this.loadingTasks.map((t=>t()))).then((()=>{this.loadingComplete=!0,this.log("All loading tasks completed"),this.checkAndFinishLoading()})).catch((t=>{this.log(`Error in loading tasks: ${t}`),this.loadingComplete=!0,this.checkAndFinishLoading()}))}checkAndFinishLoading(){if(!this.startTime)return void this.log("Start time not set yet, cannot finish loading");if(this.video&&this.videoStartTime){const t=Date.now()-this.videoStartTime,i=(t/1e3).toFixed(1);if(this.log(`Current video playing time: ${i}s / ${this.options.minLoadingDuration/1e3}s`),t<this.options.minLoadingDuration){const i=this.options.minLoadingDuration-t,e=(i/1e3).toFixed(1);return this.log(`Waiting additional ${e}s for video minimum duration`),this.finishTimeout&&clearTimeout(this.finishTimeout),void(this.finishTimeout=setTimeout((()=>{this.checkAndFinishLoading()}),i))}}if(this.log(`Loading tasks completed: ${this.loadingComplete}`),!this.loadingComplete)return;const t=Date.now()-(this.videoStartTime||this.startTime);this.log(`Total loading time: ${(t/1e3).toFixed(1)}s`),this.finishLoading()}completeLoading(){document.body.classList.remove("is-loading"),document.body.classList.add("is-loaded"),this.log('Body class changed from "is-loading" to "is-loaded"'),this.removeCoverElement(),this.log("Loading finished")}finishLoading(){this.log("Finishing loading"),this.finishTimeout&&clearTimeout(this.finishTimeout),this.loadingComplete=!0,this.isTopPage()&&(this.setVisitData(),this.log("Local storage updated with visit data and timestamp"))}waitForElement(t){return t instanceof HTMLIFrameElement?this.waitForIframe(t):this.waitForImagesAndVideos(t)}waitForImagesAndVideos(t){return new Promise((i=>{const e=Array.from(t.getElementsByTagName("img")),o=Array.from(t.getElementsByTagName("video")),s=e.length+o.length;let a=0;const n=()=>{a++,a===s&&i()};e.forEach((t=>{t.complete?n():(t.onload=n,t.onerror=n)})),o.forEach((t=>{t.readyState>=4?n():(t.oncanplaythrough=n,t.onerror=n)})),0===s&&i()}))}waitForIframe(t){return new Promise((i=>{const e=setTimeout((()=>{this.log(`Iframe load timed out: ${t.src}`),i()}),this.options.iframeTimeout);t.contentDocument&&"complete"===t.contentDocument.readyState?(clearTimeout(e),this.log(`Iframe already loaded: ${t.src}`),i()):(t.onload=()=>{clearTimeout(e),this.log(`Iframe loaded: ${t.src}`),i()},t.onerror=()=>{clearTimeout(e),this.log(`Iframe load error: ${t.src}`),i()})}))}log(t){this.options.debug&&console.log(`[Loading] ${t}`)}}window.addEventListener("DOMContentLoaded",(()=>{new t({minLoadingDuration:1500,debug:!1,waitForElementOnRevisit:".c-service-fv,.c-image-fv-img",waitForContentOnRevisit:!0})}))}();